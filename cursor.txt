-- Cursor que muestre por cada estudiante de cada año, su número de asistencias y su número de inasistencias.

DO $$
DECLARE
       REGISTRO RECORD;
	   CUR_ESTUDIANTES CURSOR FOR 
	                          select 
                              ESTUDIANTE.NOM_ESTUDIANTE,
							  ESTUDIANTE.APE_ESTUDIANTE,
							  PERIODO.ANO_PERIODO,
							  CALIFICACION.ASIS_ESTUDIANTE,
							  CALIFICACION.FALTA_ESTUDIANTE
                from ESTUDIANTE
                inner join MATRICULA on ESTUDIANTE.COD_ESTUDIANTE=MATRICULA.COD_ESTUDIANTE
                inner join CALIFICACION on MATRICULA.COD_MATRICULA= CALIFICACION.COD_MATRICULA
				INNER JOIN PERIODO ON MATRICULA.COD_PERIODO = PERIODO.COD_PERIODO;
			
BEGIN

OPEN CUR_ESTUDIANTES;
FETCH CUR_ESTUDIANTES INTO REGISTRO;
RAISE NOTICE 'NOM_ESTUDIANTE: % ,APE_ESTUDIANTE: %,ANO_PERIODO: % ,ASIS_ESTUDIANTE: % ,FALTA_ESTUDIANTE: %' ,

  REGISTRO.NOM_ESTUDIANTE, 
  REGISTRO.APE_ESTUDIANTE,
  REGISTRO.ANO_PERIODO,
  REGISTRO.ASIS_ESTUDIANTE,
  REGISTRO.FALTA_ESTUDIANTE; 
END $$   
LANGUAGE PLPGSQL;